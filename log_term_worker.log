# å½“workeræ­£åœ¨å¤„ç†è¯·æ±‚æ—¶, ç»™workerå‘é€SIGTERMðŸ“¶æµ‹è¯•

# å¯åŠ¨gunicorn: gunicorn -w 1 -k gevent app:app
[43:16] [18366] [INFO] [39m     {140736069624704} setup
[43:16] [18366] [INFO] [39m     {140736069624704} setup proc_name: app:app
[43:16] [18366] [INFO] [39m     {140736069624704} run
[43:16] [18366] [INFO] [39m     {140736069624704} start Starting gunicorn 20.0.0
[43:16] [18366] [INFO] [39m     {140736069624704} start master Master master_pid=0 reexec_pid=0
[43:16] [18366] [INFO] [39m     {140736069624704} init_signals
[43:16] [18366] [INFO] [39m     {140736069624704} create listeners fds=None
[43:16] [18366] [INFO] [39m     {140736069624704} Listening at: http://127.0.0.1:8000 (18366)
[43:16] [18366] [INFO] [39m     {140736069624704} Using worker: gevent
[43:16] [18366] [INFO] [39m     {140736069624704} spawn_workers
[43:16] [18366] [INFO] [39m     {140736069624704} SP_WKS> spawn_worker
[43:16] [18366] [INFO] [39m     {140736069624704} spawn_worker before fork
[43:16] [18366] [INFO] [39m     {140736069624704} spawn_worker after fork
# å¯åŠ¨worker
[43:16] [18369] [INFO] [36m     {140736069624704} spawn_worker after fork
[43:16] [18369] [INFO] [36m     {140736069624704} Booting worker with pid: 18369
[43:16] [18369] [INFO] [36m >>> {140736069624704} spawn_worker before worker init_process
[43:16] [18369] [INFO] [36m >>> {4509354192} init_process
[43:16] [18369] [INFO] [36m >>> {4509354192} init_signals
[43:16] [18369] [INFO] [36m >>> {4509354192} load_wsgi

# å¯åŠ¨workeråŽå‘é€è¯·æ±‚ðŸ’¥: curl localhost:8000/test-db/10
# ä¸Šé¢urlæœ€åŽçš„æ•°å­— 10 ä¼šåœ¨è¯·æ±‚è¿‡ç¨‹ä¸­ sleep(10)

# å‘é€è¯·æ±‚åŽ, é©¬ä¸Šç»™workerå‘é€SIGTERMðŸ“¶: kill -TERM 18369
[43:49] [18369] [INFO] [36m >>> {4513138368} handle_exit: 15

# ðŸ”¥ æ³¨æ„, workeræ”¶åˆ°SIGTERMðŸ“¶æ—¶æ˜¯ 49ç§’, ä¸‹é¢workeré€€å‡ºæ˜¯åœ¨ 54ç§’, ä¸­é€”éƒ½åœ¨ç­‰å¾…è¯·æ±‚å¤„ç†å®Œæ¯•
[43:54] [18369] [INFO] [36m >>> {4509354192} spawn_worker after worker init_process
[43:54] [18369] [INFO] [36m >>> {4509354192} spawn_worker except SystemExit
[43:54] [18369] [INFO] [36m >>> {4509354192} spawn_worker finally worker exiting
[43:54] [18369] [INFO] [36m     {4509354192} run except3: SystemExit

# master handler workeré€€å‡º
[43:54] [18366] [INFO] [39m     {140736069624704} handle_chld & reap_workers & wakeup
[43:54] [18366] [INFO] [39m     {140736069624704} H_CHLD> reap_workers
[43:54] [18366] [INFO] [39m     {140736069624704} H_CHLD> reap_workers wpid=18369 reexec_pid=0 master_pid=0
[43:54] [18366] [INFO] [39m     {140736069624704} H_CHLD> wakeup
[43:54] [18366] [INFO] [39m     {140736069624704} sleep except [Errno 35] Resource temporarily unavailable

# ðŸ€ masteré‡æ–°spawnä¸€ä¸ªworker
[43:54] [18366] [INFO] [39m     {140736069624704} spawn_workers
[43:54] [18366] [INFO] [39m     {140736069624704} SP_WKS> spawn_worker
[43:54] [18366] [INFO] [39m     {140736069624704} spawn_worker before fork
[43:54] [18366] [INFO] [39m     {140736069624704} spawn_worker after fork
[43:54] [18419] [INFO] [36m     {140736069624704} spawn_worker after fork
[43:54] [18419] [INFO] [36m     {140736069624704} Booting worker with pid: 18419
[43:54] [18419] [INFO] [36m >>> {140736069624704} spawn_worker before worker init_process
[43:54] [18419] [INFO] [36m >>> {4509354192} init_process
[43:54] [18419] [INFO] [36m >>> {4509354192} init_signals
[43:54] [18419] [INFO] [36m >>> {4509354192} load_wsgi
